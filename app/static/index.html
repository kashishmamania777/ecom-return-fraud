<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Return Fraud Detector — Demo</title>

  <!-- Tailwind CDN for quick styling (no build step) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* small local tweaks */
    body { background: linear-gradient(180deg,#0f172a,#020617); color: #e6eef8; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); }
    .muted { color: #9fb0d8; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
  <div class="w-full max-w-4xl">
    <header class="mb-6">
      <div class="flex items-center gap-4">
        <div class="w-14 h-14 rounded-lg bg-gradient-to-br from-indigo-500 to-sky-400 flex items-center justify-center shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M3 7h18M3 12h18M3 17h18" />
          </svg>
        </div>
        <div>
          <h1 class="text-2xl font-semibold">E-commerce Return Fraud Detector</h1>
          <p class="muted text-sm">Tiny demo: FastAPI + scikit-learn + Prometheus metrics</p>
        </div>
      </div>
    </header>

    <main class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Form card -->
      <section class="card p-6 rounded-2xl shadow-xl">
        <h2 class="text-lg font-medium mb-3">Test a return request</h2>

        <form id="predictForm" class="space-y-3">
          <div class="grid grid-cols-2 gap-3">
            <label class="flex flex-col">
              <span class="text-sm muted mb-1">User age</span>
              <input required name="user_age" type="number" min="16" max="120" value="30" class="px-3 py-2 rounded bg-transparent border border-slate-700 focus:border-sky-400 outline-none" />
            </label>

            <label class="flex flex-col">
              <span class="text-sm muted mb-1">Order value ($)</span>
              <input required name="order_value" type="number" step="0.01" value="199.99" class="px-3 py-2 rounded bg-transparent border border-slate-700 focus:border-sky-400 outline-none" />
            </label>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <label class="flex flex-col">
              <span class="text-sm muted mb-1">Days since delivery</span>
              <input required name="days_since_delivery" type="number" min="0" value="5" class="px-3 py-2 rounded bg-transparent border border-slate-700 focus:border-sky-400 outline-none" />
            </label>

            <label class="flex flex-col">
              <span class="text-sm muted mb-1">Previous returns</span>
              <input required name="num_prev_returns" type="number" min="0" value="0" class="px-3 py-2 rounded bg-transparent border border-slate-700 focus:border-sky-400 outline-none" />
            </label>
          </div>

          <label class="flex items-center gap-3">
            <input type="checkbox" name="shipping_country_same" checked class="w-4 h-4" />
            <span class="muted text-sm">Shipping country same as billing</span>
          </label>

          <div class="flex items-center gap-3 mt-3">
            <button id="submitBtn" type="submit" class="px-4 py-2 bg-sky-500 hover:bg-sky-600 rounded text-white font-medium shadow">Predict</button>
            <button id="clearBtn" type="button" class="px-3 py-2 border rounded border-slate-700 muted">Reset</button>
            <div id="spinner" class="hidden ml-2 text-sm muted">⏳ Predicting…</div>
          </div>
        </form>

        <div id="resultCard" class="mt-4 p-4 rounded-lg hidden">
          <h3 id="resultLabel" class="text-lg font-semibold"></h3>
          <p id="resultScore" class="muted mt-1"></p>
          <pre id="rawOutput" class="mt-3 p-3 rounded bg-black/20 text-sm overflow-auto hidden"></pre>
        </div>
      </section>

      <!-- Metrics + Info card -->
      <aside class="card p-6 rounded-2xl shadow-xl">
        <h2 class="text-lg font-medium mb-3">Metrics & Info</h2>

        <div class="mb-4 text-sm muted">
          <p><strong>Endpoint:</strong> <code>/predict</code> <span class="ml-2">•</span> <strong>Metrics:</strong> <code>/metrics</code></p>
          <p class="mt-2">This demo loads a small scikit-learn model and returns a probability and binary label.</p>
        </div>

        <div class="space-y-3">
          <div>
            <button id="fetchMetrics" class="px-3 py-2 bg-neutral-700 rounded text-sm">Refresh metrics</button>
          </div>

          <div id="metricsArea" class="mt-3 text-sm muted p-3 rounded bg-black/10 h-40 overflow-auto">
            <em>Metrics will appear here after you press "Refresh metrics".</em>
          </div>

          <div class="mt-4">
            <p class="muted text-sm">Try a suspicious example: high order value, many previous returns, different shipping country, short time since delivery.</p>
            <div class="mt-3 flex gap-2">
              <button id="exampleBtn" class="px-3 py-2 bg-rose-500 hover:bg-rose-600 rounded text-white text-sm">Load suspicious example</button>
            </div>
          </div>
        </div>

        <footer class="mt-6 text-xs muted">
          <p>Local demo • Not for production. Built with FastAPI + scikit-learn.</p>
        </footer>
      </aside>
    </main>
  </div>

  <script>
    const base = ''; // same origin

    function formToPayload(form) {
      const fd = new FormData(form);
      return {
        user_age: Number(fd.get('user_age') || 0),
        order_value: Number(fd.get('order_value') || 0),
        days_since_delivery: Number(fd.get('days_since_delivery') || 0),
        num_prev_returns: Number(fd.get('num_prev_returns') || 0),
        shipping_country_same: form.shipping_country_same.checked ? 1 : 0
      };
    }

    const form = document.getElementById('predictForm');
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const spinner = document.getElementById('spinner');
    const resultCard = document.getElementById('resultCard');
    const resultLabel = document.getElementById('resultLabel');
    const resultScore = document.getElementById('resultScore');
    const rawOutput = document.getElementById('rawOutput');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      resultCard.classList.add('hidden');
      rawOutput.classList.add('hidden');
      spinner.classList.remove('hidden');
      submitBtn.disabled = true;

      const payload = formToPayload(form);

      try {
        const res = await fetch(base + '/predict', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error('Request failed: ' + res.status);

        const j = await res.json();
        rawOutput.textContent = JSON.stringify(j, null, 2);
        rawOutput.classList.remove('hidden');

        const score = (j.score || 0);
        const label = j.suspicious ? 'Suspicious' : 'Not suspicious';
        resultLabel.textContent = `${label} · ${Math.round(score*100)}%`;
        resultScore.textContent = 'Probability score: ' + score.toFixed(3);

        resultCard.classList.remove('hidden');

        // small color highlight
        if (j.suspicious) {
          resultCard.classList.add('border', 'border-rose-400');
        } else {
          resultCard.classList.remove('border', 'border-rose-400');
          resultCard.classList.add('border', 'border-sky-400');
        }
      } catch (err) {
        resultLabel.textContent = 'Error';
        resultScore.textContent = String(err);
        resultCard.classList.remove('hidden');
      } finally {
        spinner.classList.add('hidden');
        submitBtn.disabled = false;
      }
    });

    clearBtn.addEventListener('click', () => {
      form.reset();
      resultCard.classList.add('hidden');
      rawOutput.classList.add('hidden');
    });

    document.getElementById('fetchMetrics').addEventListener('click', async () => {
      const area = document.getElementById('metricsArea');
      area.textContent = 'Fetching…';
      try {
        const res = await fetch(base + '/metrics');
        if (!res.ok) throw new Error('status ' + res.status);
        const text = await res.text();
        area.textContent = text;
      } catch (err) {
        area.textContent = 'Error fetching metrics: ' + err;
      }
    });

    document.getElementById('exampleBtn').addEventListener('click', () => {
      form.user_age.value = 28;
      form.order_value.value = 450;
      form.days_since_delivery.value = 2;
      form.num_prev_returns.value = 3;
      form.shipping_country_same.checked = false;
    });
  </script>
</body>
</html>
